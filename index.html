<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Skeleton: Responsive CSS Boilerplate</title>
	<meta name="description" content="">
	<meta name="author" content="Bram Leenders, Marc Romeyn">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link href='//fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>

	<link rel="stylesheet" href="./style.css">

	<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script src="http://www.amcharts.com/lib/3/amcharts.js"></script>
	<script src="http://www.amcharts.com/lib/3/serial.js"></script>
	<script src="http://www.amcharts.com/lib/3/themes/dark.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

	<!-- Favicon
	–––––––––––––––––––––––––––––––––––––––––––––––––– -->
	<link rel="icon" type="image/png" href="../../dist/images/favicon.png">

</head>
<body>
	<div class="container">
		<div class="row">
			<div class="twelve columns">
				<h1>Hacker News popularity</h1>
			</div>
		</div>

		<!-- Overall activity -->
		<div class="row">
			<div class="twelve columns">
				<h3>Overall activity</h3>
				<p>
					The activity per month; the number of articles (stories), comments and upvotes.
				</p>
				<p>
					Note that we used a <i>log</i> scale, and that the last month (June 2015) only contains data of the first half of the month.
				</p>
				</div>
		</div>
		<div class="row">
			<div class="twelve columns">
				<div id="overallActivity" class="chartdiv"></div>
			</div>
		</div>

		<!-- Topic-specific activity -->
		<div class="row">
			<div class="six columns">
				<h3>Topic-specific activity</h3>
				<input class="u-full-width" type="text" placeholder="Topic id (default is 0)" id="topicid">
				<p id="warning"></p>
			</div>
			<div class="six columns">
				<ul id="keywords">
					<!-- keywords show here... -->
				</ul>
			</div>
		</div>
		<div class="row">
			<div class="twelve columns">
				<div id="specificActivity" class="chartdiv"></div>
			</div>
		</div>
	</div>
</body>


	<script language="Javascript">
		var dataset;
		var keywords;
		var changingChart;

		$.getJSON("./scores.json")
			.fail(function() {
				console.log("An error occured fetching the topic scores...");
			})
			.done(function(result) {
				dataset = result;

				// Draw main chart
		    	drawGraph(dataset.totals, "overallActivity");

		    	// Draw topic-specific chart
		    	changingChart = drawGraph(prepareData(0), "specificActivity");
		    });

		$.getJSON("./keywords.json")
			.fail(function() {
				console.log("An error occured fetching the keywords...");
			})
			.done(function(result) {
				keywords = result;

				updateKeywords(0);
		    });

	    $('input#topicid').keyup(function() {
	    	if($(this).val().length > 0) {
		    	var topicId = JSON.parse($(this).val());
		    	
		    	if(! isNaN(topicId) && 0 <= topicId && topicId <= 999) {
		    		updateTopic(topicId);
		    		updateKeywords(topicId);
		    		$('#warning').html("");
		    	} else {
		    		$('#warning').html("Please enter a number in the range 0 to 999.");
		    	}
		    }
	    });

	    var prepareData = function(topicId) {
	    	var output = [];
	    	for(var i = 0; i < dataset.topicseries[topicId].points.length; i++) {
	    		output[i] = {
	    			date: dataset.totals[i].date,
	    			articles: dataset.topicseries[topicId].articles[i],
	    			points: dataset.topicseries[topicId].points[i],
	    			comments: dataset.topicseries[topicId].comments[i]
	    		};
	    	}
	    	return output;
	    }

	    var updateTopic = function(topicId) {
	    	changingChart.dataProvider = prepareData(topicId);
	    	changingChart.validateData();
	    };

	    var updateKeywords = function(topicId) {
	    	var html = '';
			for(var i = 0; i < keywords[topicId].length; i++) {
				html += '<li>' + keywords[topicId][i].w + ' - <i>' + keywords[topicId][i].s + '</i>';
			}
			$('#keywords').html(html);
	    };

		var drawGraph = function(dataset, id) {
			return AmCharts.makeChart(id, {
			    "type": "serial",
			    "theme": "light",
			    "marginRight": 80,
			    "marginTop": 17,
			    "autoMarginOffset": 20,
			    "dataProvider": dataset,
			    "valueAxes": [{
			        // "logarithmic": true,
			        "dashLength": 1,
			        "guides": [{
			            "dashLength": 6,
			            "inside": true,
			            "label": "average",
			            "lineAlpha": 1,
			            "value": 90.4
			        }],
			        "position": "left"
			    }],
			    "graphs": [{
			        "bullet": "round",
			        "id": "a",
			        "bulletBorderAlpha": 1,
			        "bulletSize": 2,
			        "lineThickness": 1,
			        "title": "Articles",
			        "type": "smoothedLine",
			        "useLineColorForBulletBorder": true,
			        "valueField": "articles"
			    },
			    {
			        "bullet": "round",
			        "id": "p",
			        "bulletBorderAlpha": 1,
			        "bulletSize": 2,
			        "lineThickness": 1,
			        "title": "Points",
			        "type": "smoothedLine",
			        "useLineColorForBulletBorder": true,
			        "valueField": "points"
			    },
			    {
			        "bullet": "round",
			        "id": "c",
			        "bulletBorderAlpha": 1,
			        "bulletSize": 2,
			        "lineThickness": 1,
			        "title": "Comments",
			        "type": "smoothedLine",
			        "useLineColorForBulletBorder": true,
			        "valueField": "comments"
			    }],
			    "chartScrollbar": {},
			    "chartCursor": {
			        "valueLineEnabled": true,
			        "valueLineBalloonEnabled": true,
			        "valueLineAlpha": 0.5,
			        "fullWidth": true,
			        "cursorAlpha": 0.05
			    },
			    "dataDateFormat": "YYYY-MM",
			    "categoryField": "date",
			    "categoryAxis": {
			        "parseDates": true
			    },
			    "export": {
			        "enabled": true
			    },
			    "legend": {
					"useGraphSettings": true
				}
			});
		};
	</script>
</html>